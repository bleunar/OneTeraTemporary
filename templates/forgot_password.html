<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - 1TERA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fp.css') }}">
</head>
<body>
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="auth-flash-messages">
                {% for category, message in messages %}
                    <div class="auth-alert auth-alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="forgot-password-container">
        <div class="auth-header">
            <div class="logo-section">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="1TERA Logo" class="auth-logo-image" onerror="this.style.display='none'">
            </div>
            <h2>ONE Tigbauan Emergency Response App</h2>
        </div>
        
        <div class="forgot-password-form">
            {% if step == 'email' %}
            <h1>Reset Your Password</h1>
            <p class="form-description">
                Enter your email address and we'll send you an OTP to reset your password.
            </p>
            
            <form method="POST" action="{{ url_for('forgot_password') }}" autocomplete="off">
                <div class="input-group">
                    <input type="email" id="email" name="email" placeholder="Email Address" required autocomplete="off" value="{{ request.form.email if request.form }}">
                    <label for="email"><i class="fas fa-envelope"></i></label>
                </div>
                
                <button type="submit" class="submit-btn">
                    <span id="submitText">Send OTP</span>
                    <div id="submitSpinner" class="spinner" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </button>
            </form>
            
            {% elif step == 'verify_otp' %}
            <h1>Verify OTP</h1>
            <p class="form-description">
                We've sent a verification code to your email. Enter it below to continue.
            </p>
            
            <form method="POST" action="{{ url_for('verify_forgot_password_otp') }}" autocomplete="off">
                <input type="hidden" name="email" value="{{ email }}">
                
                <div class="otp-input-container">
                    <input type="text" id="otp" name="otp" class="otp-input" placeholder="000000" required 
                           maxlength="6" pattern="[0-9]{6}" title="Please enter a 6-digit OTP"
                           inputmode="numeric">
                </div>
                
                <button type="submit" class="submit-btn">
                    <span id="submitText">Verify OTP</span>
                    <div id="submitSpinner" class="spinner" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </button>
            </form>
            
            {% elif step == 'reset_password' %}
            <h1>Create New Password</h1>
            <p class="form-description">
                Enter your new password below.
            </p>
            
            <form method="POST" action="{{ url_for('reset_password') }}" autocomplete="off" id="resetPasswordForm">
                <input type="hidden" name="email" value="{{ email }}">
                <input type="hidden" name="otp" value="{{ otp }}">
                
                <div class="input-group">
                    <input type="password" id="new_password" name="new_password" placeholder="New Password" required autocomplete="new-password">
                    <label for="new_password"><i class="fas fa-lock"></i></label>
                    <span class="toggle-password" onclick="togglePasswordVisibility('new_password')">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>
                
                <div class="input-group">
                    <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm New Password" required autocomplete="new-password">
                    <label for="confirm_password"><i class="fas fa-lock"></i></label>
                    <span class="toggle-password" onclick="togglePasswordVisibility('confirm_password')">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>
                
                <!-- Password Validation -->
                <div class="password-validation" id="passwordValidation">
                    <div class="validation-title">Password Requirements</div>
                    <ul class="validation-rules">
                        <li id="rule-length" class="invalid">
                            <i class="fas fa-times"></i>
                            At least 8 characters
                        </li>
                        <li id="rule-uppercase" class="invalid">
                            <i class="fas fa-times"></i>
                            One uppercase letter (A-Z)
                        </li>
                        <li id="rule-lowercase" class="invalid">
                            <i class="fas fa-times"></i>
                            One lowercase letter (a-z)
                        </li>
                        <li id="rule-special" class="invalid">
                            <i class="fas fa-times"></i>
                            One special character (!@#$% etc.)
                        </li>
                        <li id="rule-match" class="invalid">
                            <i class="fas fa-times"></i>
                            Passwords match
                        </li>
                    </ul>
                    <div class="password-strength">
                        <div class="strength-bar" id="strength-bar"></div>
                    </div>
                </div>
                
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span id="submitText">Reset Password</span>
                    <div id="submitSpinner" class="spinner" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                </button>
            </form>
            {% endif %}
            
            <div class="auth-links">
                <p><a href="{{ url_for('login') }}"><i class="fas fa-arrow-left"></i> Back to Login</a></p>
                {% if step == 'verify_otp' %}
<p>Didn't receive the code? <a href="{{ url_for('resend_forgot_password_otp', email=email) }}">Resend OTP</a></p>
{% endif %}
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/fp.js') }}"></script>
    <script src="{{ url_for('static', filename='js/otp.js') }}"></script>
    <script src="{{ url_for('static', filename='js/security.js') }}"></script>

</body>
</html>